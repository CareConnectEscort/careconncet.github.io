<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareConnect HK - Medical Escort Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- EmailJS SDK -->
    <script  src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#1f2937'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #5D5CDE 0%, #7c3aed 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hidden { display: none !important; }
        .show { display: block !important; }
        .star-rating .star {
            cursor: pointer;
            color: #ddd;
            font-size: 1.5rem;
        }
        .star-rating .star.active {
            color: #fbbf24;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <span class="font-bold text-xl text-primary">CareConnect HK</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="user-greeting" class="hidden"></span>
                    <!-- Role Switch Button -->
                    <button id="role-switch-btn" onclick="switchRole()" class="hidden bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 px-4 py-2 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-800 transition-colors text-sm">
                        üîÑ Switch Role
                    </button>
                    <!-- Undo Button -->
                    <button id="undo-btn" onclick="undoLastAction()" class="hidden bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 px-4 py-2 rounded-lg hover:bg-orange-200 dark:hover:bg-orange-800 transition-colors text-sm" title="Undo last action">
                        ‚Ü∂ Undo
                    </button>
                    <button id="login-btn" onclick="showLogin()" class="text-primary hover:text-purple-600 font-medium">Login</button>
                    <button id="register-btn" onclick="showRegister()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">Register</button>
                    <button id="logout-btn" onclick="logout()" class="hidden text-gray-600 dark:text-gray-400 hover:text-primary">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div id="main-content">

        <!-- Landing Page -->
        <div id="landing-page" class="animate-fade-in">
            <!-- Hero Section -->
            <section class="gradient-bg text-white py-20">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                    <h1 class="text-5xl font-bold mb-6">CareConnect HK</h1>
                    <p class="text-xl mb-8 max-w-3xl mx-auto">Connecting elderly patients with compassionate medical escorts across Hong Kong</p>
                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="showRegister('patient')" class="bg-white text-primary px-8 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors">I Need an Escort</button>
                        <button onclick="showRegister('escort')" class="border-2 border-white px-8 py-3 rounded-lg font-medium hover:bg-white hover:text-primary transition-colors">Become an Escort</button>
                    </div>
                </div>
            </section>

            <!-- Features -->
            <section class="py-16">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h2 class="text-3xl font-bold text-center mb-12">How It Works</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="card-hover bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg text-center">
                            <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">üë§</span>
                            </div>
                            <h3 class="text-xl font-semibold mb-3">1. Create Your Profile</h3>
                            <div class="text-left space-y-2 mb-4">
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    <span class="font-medium">For Patients:</span><br>
                                    ‚Ä¢ Choose your age category (elderly/adult/children)<br>
                                    ‚Ä¢ Specify medical conditions & mobility needs<br>
                                    ‚Ä¢ Set preferred escort experience level<br>
                                    ‚Ä¢ Add emergency contact information
                                </p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    <span class="font-medium">For Escorts:</span><br>
                                    ‚Ä¢ Share your experience & qualifications<br>
                                    ‚Ä¢ Set your hourly rates & availability<br>
                                    ‚Ä¢ Choose volunteer opportunities<br>
                                    ‚Ä¢ Complete identity verification
                                </p>
                            </div>
                            <div class="text-center">
                                <span class="inline-block px-3 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full">
                                    2-3 minutes setup
                                </span>
                            </div>
                        </div>

                        <div class="card-hover bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg text-center">
                            <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">üîç</span>
                            </div>
                            <h3 class="text-xl font-semibold mb-3">2. Smart Matching</h3>
                            <div class="text-left space-y-2 mb-4">
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    <span class="font-medium">Advanced Filters:</span><br>
                                    ‚Ä¢ üìç Location & district proximity<br>
                                    ‚Ä¢ üó£Ô∏è Language preferences (Cantonese/Mandarin/English)<br>
                                    ‚Ä¢ üí∞ Budget range (Free volunteer to $150/hour)<br>
                                    ‚Ä¢ ‚≠ê Experience level & ratings
                                </p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    <span class="font-medium">Real-time Features:</span><br>
                                    ‚Ä¢ Live availability status<br>
                                    ‚Ä¢ Instant booking confirmation<br>
                                    ‚Ä¢ Emergency escort matching<br>
                                    ‚Ä¢ Background-checked escorts only
                                </p>
                            </div>
                            <div class="text-center">
                                <span class="inline-block px-3 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full">
                                    Average 12 matches found
                                </span>
                            </div>
                        </div>

                        <div class="card-hover bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg text-center">
                            <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">üìÖ</span>
                            </div>
                            <h3 class="text-xl font-semibold mb-3">3. Book & Connect</h3>
                            <div class="text-left space-y-2 mb-4">
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    <span class="font-medium">Easy Booking:</span><br>
                                    ‚Ä¢ Select date, time & destination<br>
                                    ‚Ä¢ Choose paid service or free volunteer<br>
                                    ‚Ä¢ Add special medical requirements<br>
                                    ‚Ä¢ Secure online payment processing
                                </p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    <span class="font-medium">Stay Connected:</span><br>
                                    ‚Ä¢ Real-time booking confirmations<br>
                                    ‚Ä¢ GPS tracking during escort service<br>
                                    ‚Ä¢ 24/7 emergency support hotline<br>
                                    ‚Ä¢ Post-service rating & feedback
                                </p>
                            </div>
                            <div class="text-center">
                                <span class="inline-block px-3 py-1 text-xs bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full">
                                    96% booking success rate
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Features Section -->
                    <div class="mt-16 bg-gradient-to-r from-primary/5 to-purple-500/5 rounded-2xl p-8">
                        <h3 class="text-2xl font-bold text-center mb-8">Why Choose CareConnect?</h3>
                        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="text-center">
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="text-xl">üõ°Ô∏è</span>
                                </div>
                                <h4 class="font-semibold mb-1">Verified Escorts</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">All escorts undergo background checks and identity verification</p>
                            </div>
                            <div class="text-center">
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="text-xl">üí∞</span>
                                </div>
                                <h4 class="font-semibold mb-1">Transparent Pricing</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">No hidden fees. Free volunteer options for financial assistance recipients</p>
                            </div>
                            <div class="text-center">
                                <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="text-xl">‚ö°</span>
                                </div>
                                <h4 class="font-semibold mb-1">Emergency Support</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Urgent bookings available within 30 minutes during emergencies</p>
                            </div>
                            <div class="text-center">
                                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="text-xl">üì±</span>
                                </div>
                                <h4 class="font-semibold mb-1">Family Access</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Relatives can book and pay for elderly family members remotely</p>
                            </div>
                        </div>

                        <div class="mt-8 text-center">
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div>
                                    <div class="text-2xl font-bold text-primary">70%</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Cost Savings vs Private Services</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-primary">15min</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Average Booking Time</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-primary">500+</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Verified Escorts</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-primary">4.8‚≠ê</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Average User Rating</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Find Available Escorts -->
            <section class="py-16 bg-white dark:bg-gray-800">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl font-bold mb-4">Find Available Escorts Near You</h2>
                        <p class="text-xl text-gray-600 dark:text-gray-400">Browse verified medical escorts ready to assist across Hong Kong</p>
                    </div>

                    <!-- Filter Bar -->
                    <div class="mb-8 bg-gray-50 dark:bg-gray-700 rounded-xl p-6">
                        <div class="grid md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">District</label>
                                <select id="filter-district" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800">
                                    <option value="">All Districts</option>
                                    <option value="Central & Western">Central & Western</option>
                                    <option value="Wan Chai">Wan Chai</option>
                                    <option value="Eastern">Eastern</option>
                                    <option value="Sha Tin">Sha Tin</option>
                                    <option value="Kowloon City">Kowloon City</option>
                                    <option value="Yuen Long">Yuen Long</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Experience</label>
                                <select id="filter-experience" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800">
                                    <option value="">All Levels</option>
                                    <option value="professional">Healthcare Professional</option>
                                    <option value="experienced">Experienced</option>
                                    <option value="some">Some Experience</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Price Range</label>
                                <select id="filter-price" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800">
                                    <option value="">Any Price</option>
                                    <option value="volunteer">Free (Volunteer)</option>
                                    <option value="0-50">$0-50/hour</option>
                                    <option value="50-100">$50-100/hour</option>
                                    <option value="100+">$100+/hour</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Language</label>
                                <select id="filter-language" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800">
                                    <option value="">Any Language</option>
                                    <option value="cantonese">Cantonese</option>
                                    <option value="mandarin">Mandarin</option>
                                    <option value="english">English</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Escort Listings -->
                    <div id="landing-escorts-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Escort cards will be populated by JavaScript -->
                    </div>

                    <!-- CTA Section -->
                    <div class="mt-12 text-center bg-gradient-to-r from-primary/10 to-purple-500/10 rounded-2xl p-8">
                        <h3 class="text-2xl font-bold mb-4">Ready to Get Started?</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 max-w-2xl mx-auto">
                            Join CareConnect today to access our full network of verified medical escorts across all 18 Hong Kong districts.
                        </p>
                        <div class="flex flex-col sm:flex-row justify-center gap-4">
                            <button onclick="showRegister('patient')" class="bg-primary text-white px-8 py-3 rounded-lg font-medium hover:bg-purple-600 transition-colors">
                                Find an Escort Now
                            </button>
                            <button onclick="showRegister('escort')" class="border-2 border-primary text-primary px-8 py-3 rounded-lg font-medium hover:bg-primary hover:text-white transition-colors">
                                Become an Escort
                            </button>
                        </div>
                        <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-6 text-center">
                            <div>
                                <div class="text-2xl font-bold text-primary mb-1">500+</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Available Escorts</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-primary mb-1">24/7</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Emergency Support</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-primary mb-1">4.8‚≠ê</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Average Rating</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-primary mb-1">18</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Districts Covered</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Authentication Forms -->
        <div id="auth-page" class="hidden min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-md w-full space-y-8">
                <!-- Back to Home Button -->
                <div class="text-center">
                    <button onclick="backToHome()" class="inline-flex items-center text-primary hover:text-purple-600 transition-colors mb-4">
                        <span class="text-xl mr-2">‚Üê</span>
                        Back to Home
                    </button>
                </div>
                <div class="text-center">
                    <h2 id="auth-title" class="text-3xl font-bold">Join CareConnect</h2>
                    <p id="auth-subtitle" class="mt-2 text-gray-600 dark:text-gray-400">Create your account to get started</p>
                </div>

                <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg p-8">
                    <form id="auth-form" onsubmit="handleAuth(event)">
                        <div class="space-y-6">
                            <!-- User Type Selection -->
                            <div id="user-type-selection">
                                <label class="block text-sm font-medium mb-2">I am a:</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <label class="cursor-pointer">
                                        <input type="radio" name="userType" value="patient" class="sr-only peer">
                                        <div class="border-2 border-gray-200 dark:border-gray-600 peer-checked:border-primary peer-checked:bg-primary/5 rounded-lg p-4 text-center transition-all">
                                            <span class="text-2xl block mb-2">üë§</span>
                                            <span class="font-medium">Patient</span>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="userType" value="escort" class="sr-only peer">
                                        <div class="border-2 border-gray-200 dark:border-gray-600 peer-checked:border-primary peer-checked:bg-primary/5 rounded-lg p-4 text-center transition-all">
                                            <span class="text-2xl block mb-2">ü§ù</span>
                                            <span class="font-medium">Escort</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Basic Info -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">First Name</label>
                                    <input type="text" name="firstName" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Last Name</label>
                                    <input type="text" name="lastName" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-1">Email</label>
                                <input type="email" name="email" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-1">Phone</label>
                                <input type="tel" name="phone" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-1">District</label>
                                <select name="district" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                    <option value="">Select your district</option>
                                    <option value="central-western">Central & Western</option>
                                    <option value="eastern">Eastern</option>
                                    <option value="southern">Southern</option>
                                    <option value="wan-chai">Wan Chai</option>
                                    <option value="kowloon-city">Kowloon City</option>
                                    <option value="kwun-tong">Kwun Tong</option>
                                    <option value="sham-shui-po">Sham Shui Po</option>
                                    <option value="wong-tai-sin">Wong Tai Sin</option>
                                    <option value="yau-tsim-mong">Yau Tsim Mong</option>
                                    <option value="islands">Islands</option>
                                    <option value="kwai-tsing">Kwai Tsing</option>
                                    <option value="north">North</option>
                                    <option value="sai-kung">Sai Kung</option>
                                    <option value="sha-tin">Sha Tin</option>
                                    <option value="tai-po">Tai Po</option>
                                    <option value="tsuen-wan">Tsuen Wan</option>
                                    <option value="tuen-mun">Tuen Mun</option>
                                    <option value="yuen-long">Yuen Long</option>
                                </select>
                            </div>

                            <!-- Patient-specific fields -->
                            <div id="patient-fields" class="hidden space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Age</label>
                                    <input type="number" name="age" min="18" max="120" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-1">Patient Category</label>
                                    <select name="patientCategory" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                        <option value="">Select category</option>
                                        <option value="elderly">Elderly (65+ years)</option>
                                        <option value="children">Children (under 18 years)</option>
                                        <option value="adult">Adult (18-64 years)</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-1">Expected Escort Experience</label>
                                    <select name="expectedExperience" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                        <option value="">Select preferred experience level</option>
                                        <option value="any">Any experience level</option>
                                        <option value="some">Some experience preferred</option>
                                        <option value="experienced">Experienced escorts only</option>
                                        <option value="professional">Healthcare professionals only</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-1">Emergency Contact Number</label>
                                    <input type="tel" name="emergencyContact" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700" placeholder="Family member or emergency contact">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-1">Medical Conditions (optional)</label>
                                    <textarea name="medicalConditions" rows="3" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700" placeholder="Describe any conditions that escorts should be aware of"></textarea>
                                </div>
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="needsFinancialAssistance" class="mr-2">
                                        <span class="text-sm">I am receiving financial assistance (CSSA/Disability Allowance)</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Escort-specific fields -->
                            <div id="escort-fields" class="hidden space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Experience</label>
                                    <select name="experience" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                        <option value="">Select experience level</option>
                                        <option value="none">No experience</option>
                                        <option value="some">Some experience</option>
                                        <option value="experienced">Experienced</option>
                                        <option value="professional">Healthcare professional</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-1">Emergency Contact Number</label>
                                    <input type="tel" name="emergencyContact" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700" placeholder="Family member or emergency contact">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-1">Languages</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" name="languages" value="cantonese" class="mr-2">
                                            <span>Cantonese</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="languages" value="mandarin" class="mr-2">
                                            <span>Mandarin</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="languages" value="english" class="mr-2">
                                            <span>English</span>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Hourly Rate (HKD)</label>
                                    <input type="number" name="hourlyRate" min="0" max="500" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                </div>
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="volunteerWork" class="mr-2">
                                        <span class="text-sm">I'm interested in volunteer work</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Privacy Agreement -->
                            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                                <label class="flex items-start">
                                    <input type="checkbox" name="privacyAgreement" required class="mr-3 mt-1">
                                    <span class="text-sm text-gray-700 dark:text-gray-300">
                                        I agree that CareConnect HK may collect and share my personal information with matched escorts for service delivery purposes. This includes my contact details, medical conditions, and booking preferences as outlined in our
                                        <a href="#" class="text-primary hover:underline">Privacy Policy</a>.
                                    </span>
                                </label>
                            </div>

                            <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-purple-600 transition-colors">
                                Create Account
                            </button>
                        </div>
                    </form>

                    <div class="mt-6 text-center">
                        <button onclick="showLogin()" class="text-primary hover:text-purple-600">Already have an account? Sign in</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Form -->
        <div id="login-page" class="hidden min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-md w-full space-y-8">
                <!-- Back to Home Button -->
                <div class="text-center">
                    <button onclick="backToHome()" class="inline-flex items-center text-primary hover:text-purple-600 transition-colors mb-4">
                        <span class="text-xl mr-2">‚Üê</span>
                        Back to Home
                    </button>
                </div>
                <div class="text-center">
                    <h2 class="text-3xl font-bold">Welcome Back</h2>
                    <p class="mt-2 text-gray-600 dark:text-gray-400">Sign in to your account</p>
                </div>

                <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg p-8">
                    <form onsubmit="handleLogin(event)">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium mb-1">Email</label>
                                <input type="email" name="email" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Password</label>
                                <input type="password" name="password" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                            </div>
                            <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-purple-600 transition-colors">
                                Sign In
                            </button>
                        </div>
                    </form>

                    <div class="mt-6 text-center">
                        <button onclick="showRegister()" class="text-primary hover:text-purple-600">Don't have an account? Sign up</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden min-h-screen bg-gray-50 dark:bg-gray-900">
            <!-- Patient Dashboard -->
            <div id="patient-dashboard" class="hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold mb-2">Patient Dashboard</h1>
                        <p class="text-gray-600 dark:text-gray-400">Find and book medical escorts for your appointments</p>
                    </div>

                    <!-- Quick Stats -->
                    <div class="grid md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Upcoming</h3>
                            <p class="text-2xl font-bold text-primary">2</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Completed</h3>
                            <p class="text-2xl font-bold text-green-600">12</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Saved</h3>
                            <p class="text-2xl font-bold text-gray-600 dark:text-gray-300">$2,400</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Rating</h3>
                            <p class="text-2xl font-bold text-yellow-500">4.8‚≠ê</p>
                        </div>
                    </div>

                    <!-- Active Escort Tracking (shown when appointment is active) -->
                    <div id="active-tracking" class="hidden mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-primary to-purple-600 text-white p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h2 class="text-xl font-semibold">Active Appointment</h2>
                                        <p class="text-sm opacity-90">Your escort is on the way</p>
                                    </div>
                                    <button onclick="hideTracking()" class="text-white hover:bg-white/20 rounded-full p-2">
                                        <span class="text-xl">‚úï</span>
                                    </button>
                                </div>
                            </div>

                            <div class="p-6">
                                <div class="grid md:grid-cols-2 gap-6">
                                    <!-- Location Tracking -->
                                    <div>
                                        <h3 class="font-semibold mb-3 flex items-center">
                                            <span class="text-xl mr-2">üìç</span>
                                            Live Location Tracking
                                        </h3>
                                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4 mb-4 h-64 flex items-center justify-center relative overflow-hidden">
                                            <!-- Simulated Map -->
                                            <div class="absolute inset-0 bg-gradient-to-br from-blue-100 to-green-100 dark:from-blue-900 dark:to-green-900 opacity-50"></div>
                                            <div class="relative z-10 text-center">
                                                <div class="text-4xl mb-2 animate-pulse">üìç</div>
                                                <p class="text-sm font-medium" id="escort-location">Escort Location: Central MTR Station</p>
                                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1" id="distance-info">Approximately 2.3 km away</p>
                                                <div class="mt-4 bg-white dark:bg-gray-800 rounded-lg p-3 inline-block">
                                                    <p class="text-xs text-gray-500 dark:text-gray-400">Estimated arrival</p>
                                                    <p class="text-lg font-bold text-primary" id="eta-time">8 minutes</p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Journey Details -->
                                        <div class="space-y-2">
                                            <div class="flex items-center text-sm">
                                                <span class="w-8 h-8 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mr-3">
                                                    <span class="text-green-600 dark:text-green-400">‚úì</span>
                                                </span>
                                                <div class="flex-1">
                                                    <p class="font-medium">Escort confirmed</p>
                                                    <p class="text-xs text-gray-500">10:15 AM</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center text-sm">
                                                <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mr-3 animate-pulse">
                                                    <span class="text-blue-600 dark:text-blue-400">‚Üí</span>
                                                </span>
                                                <div class="flex-1">
                                                    <p class="font-medium">En route to pickup</p>
                                                    <p class="text-xs text-gray-500">Current status</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center text-sm opacity-50">
                                                <span class="w-8 h-8 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mr-3">
                                                    <span class="text-gray-600 dark:text-gray-400">‚óã</span>
                                                </span>
                                                <div class="flex-1">
                                                    <p class="font-medium">Arrive at Queen Mary Hospital</p>
                                                    <p class="text-xs text-gray-500">Expected 11:00 AM</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Messaging -->
                                    <div>
                                        <h3 class="font-semibold mb-3 flex items-center">
                                            <span class="text-xl mr-2">üí¨</span>
                                            Message Your Escort
                                        </h3>

                                        <!-- Escort Info Card -->
                                        <div class="bg-gradient-to-r from-primary/10 to-purple-500/10 rounded-lg p-4 mb-4">
                                            <div class="flex items-center space-x-3">
                                                <div class="text-3xl">üë©‚Äç‚öïÔ∏è</div>
                                                <div class="flex-1">
                                                    <h4 class="font-semibold">Mary Chen</h4>
                                                    <p class="text-sm text-gray-600 dark:text-gray-400">Elderly Care Specialist</p>
                                                    <p class="text-xs text-green-600 dark:text-green-400 mt-1">‚óè Online</p>
                                                </div>
                                                <button onclick="callEscort()" class="bg-primary text-white p-3 rounded-full hover:bg-purple-600 transition-colors">
                                                    <span class="text-xl">üìû</span>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Chat Messages -->
                                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 h-64 overflow-y-auto mb-4" id="chat-messages">
                                            <div class="space-y-3">
                                                <!-- Escort Message -->
                                                <div class="flex items-start space-x-2">
                                                    <div class="text-xl">üë©‚Äç‚öïÔ∏è</div>
                                                    <div class="bg-white dark:bg-gray-600 rounded-lg p-3 max-w-xs">
                                                        <p class="text-sm">Good morning! I'm on my way to pick you up. I'll be there in about 8 minutes.</p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">10:20 AM</p>
                                                    </div>
                                                </div>

                                                <!-- Patient Message -->
                                                <div class="flex items-start space-x-2 justify-end">
                                                    <div class="bg-primary text-white rounded-lg p-3 max-w-xs">
                                                        <p class="text-sm">Thank you! I'll be waiting at the lobby.</p>
                                                        <p class="text-xs opacity-75 mt-1">10:21 AM</p>
                                                    </div>
                                                    <div class="text-xl">üë§</div>
                                                </div>

                                                <!-- System Message -->
                                                <div class="text-center">
                                                    <span class="inline-block bg-gray-200 dark:bg-gray-600 rounded-full px-3 py-1 text-xs text-gray-600 dark:text-gray-300">
                                                        Mary is 2.3 km away
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Message Input -->
                                        <div class="flex space-x-2">
                                            <input type="text" id="message-input" placeholder="Type your message..." class="flex-1 text-base px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                            <button onclick="sendMessage()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                                                Send
                                            </button>
                                        </div>

                                        <!-- Quick Actions -->
                                        <div class="mt-4 flex flex-wrap gap-2">
                                            <button onclick="sendQuickMessage('I\'m ready')" class="text-xs bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                                I'm ready ‚úì
                                            </button>
                                            <button onclick="sendQuickMessage('Running 5 minutes late')" class="text-xs bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                                Running late ‚è∞
                                            </button>
                                            <button onclick="sendQuickMessage('Please call me')" class="text-xs bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                                Call me üìû
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Emergency Button -->
                                <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-600">
                                    <button onclick="showEmergencyOptions()" class="w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition-colors font-medium">
                                        üö® Emergency / Need Help
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Toggle Tracking Button -->
                    <div class="mb-4">
                        <button onclick="toggleTracking()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                            üìç Show Active Appointment Tracking
                        </button>
                    </div>

                    <div class="grid lg:grid-cols-3 gap-8">
                        <!-- Main Content -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Search Section -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <h2 class="text-xl font-semibold mb-4">Find Medical Escorts</h2>
                                <div class="grid md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Date Needed</label>
                                        <input type="date" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Time</label>
                                        <select class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                            <option>Morning (9am-12pm)</option>
                                            <option>Afternoon (12pm-5pm)</option>
                                            <option>Evening (5pm-8pm)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Language</label>
                                        <select class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                            <option>Any</option>
                                            <option>Cantonese</option>
                                            <option>Mandarin</option>
                                            <option>English</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Max Budget</label>
                                        <select class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                            <option>Free (Volunteer)</option>
                                            <option>$50/hour</option>
                                            <option>$100/hour</option>
                                            <option>$150/hour</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Experience</label>
                                        <select class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                            <option>Any</option>
                                            <option>Some experience</option>
                                            <option>Experienced</option>
                                            <option>Healthcare professional</option>
                                        </select>
                                    </div>
                                </div>
                                <button onclick="searchEscorts()" class="w-full bg-primary text-white py-2 rounded-lg hover:bg-purple-600 transition-colors">
                                    Search Available Escorts
                                </button>
                            </div>

                            <!-- Search Results -->
                            <div id="search-results" class="hidden bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">Available Escorts</h3>
                                <div id="escorts-list" class="space-y-4"></div>
                            </div>
                        </div>

                        <!-- Sidebar -->
                        <div class="space-y-6">
                            <!-- Upcoming Appointments -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">Upcoming Appointments</h3>
                                <div class="space-y-3">
                                    <div class="border-l-4 border-primary pl-3">
                                        <p class="font-medium">Cardiology Check-up</p>
                                        <p class="text-sm text-gray-500">Tomorrow, 10:00 AM</p>
                                        <p class="text-sm text-gray-500">with Mary Chen</p>
                                    </div>
                                    <div class="border-l-4 border-primary pl-3">
                                        <p class="font-medium">Orthopedic Consultation</p>
                                        <p class="text-sm text-gray-500">Dec 28, 2:00 PM</p>
                                        <p class="text-sm text-gray-500">with John Wong</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
                                <div class="space-y-3">
                                    <button onclick="showEmergencyBooking()" class="w-full text-left p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                        üö® Emergency Booking
                                    </button>
                                    <button class="w-full text-left p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                        üìù Update Medical Info
                                    </button>
                                    <button class="w-full text-left p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                        üí≥ Payment Methods
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Escort Dashboard -->
            <div id="escort-dashboard" class="hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold mb-2">Escort Dashboard</h1>
                        <p class="text-gray-600 dark:text-gray-400">Manage your bookings and help patients in your community</p>
                    </div>

                    <!-- Quick Stats -->
                    <div class="grid md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">This Month</h3>
                            <p class="text-2xl font-bold text-primary">8 Jobs</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Earnings</h3>
                            <p class="text-2xl font-bold text-green-600">$1,200</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Rating</h3>
                            <p class="text-2xl font-bold text-yellow-500">4.9‚≠ê</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Helped</h3>
                            <p class="text-2xl font-bold text-purple-600">45</p>
                        </div>
                    </div>

                    <div class="grid lg:grid-cols-3 gap-8">
                        <!-- Main Content -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Available Jobs -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <h2 class="text-xl font-semibold mb-4">Available Jobs</h2>
                                <div id="available-jobs" class="space-y-4">
                                    <!-- Job listings will be populated here -->
                                </div>
                                <button onclick="loadMoreJobs()" class="w-full mt-4 text-primary border border-primary py-2 rounded-lg hover:bg-primary hover:text-white transition-colors">
                                    Load More Jobs
                                </button>
                            </div>
                        </div>

                        <!-- Sidebar -->
                        <div class="space-y-6">
                            <!-- My Schedule -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">My Schedule</h3>
                                <div class="space-y-3">
                                    <div class="border-l-4 border-green-500 pl-3">
                                        <p class="font-medium">Mrs. Lee - Clinic Visit</p>
                                        <p class="text-sm text-gray-500">Tomorrow, 9:00 AM</p>
                                        <p class="text-sm text-green-600">Confirmed</p>
                                    </div>
                                    <div class="border-l-4 border-blue-500 pl-3">
                                        <p class="font-medium">Mr. Chan - Hospital</p>
                                        <p class="text-sm text-gray-500">Dec 28, 2:00 PM</p>
                                        <p class="text-sm text-blue-600">Pending</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Availability -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">Set Availability</h3>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="mr-2">
                                        <span>Available for emergency calls</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="mr-2">
                                        <span>Weekend availability</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2">
                                        <span>Overnight assistance</span>
                                    </label>
                                </div>
                                <button class="w-full mt-4 bg-primary text-white py-2 rounded-lg hover:bg-purple-600 transition-colors">
                                    Update Availability
                                </button>
                            </div>

                            <!-- Profile Completion -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">Profile Completion</h3>
                                <div class="mb-2">
                                    <div class="flex justify-between text-sm">
                                        <span>Profile Strength</span>
                                        <span>85%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-1">
                                        <div class="bg-primary h-2 rounded-full" style="width: 85%"></div>
                                    </div>
                                </div>
                                <ul class="text-sm space-y-1">
                                    <li class="text-green-600">‚úì Photo uploaded</li>
                                    <li class="text-green-600">‚úì Experience added</li>
                                    <li class="text-gray-500">‚óã Add certifications</li>
                                    <li class="text-gray-500">‚óã Complete training</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Booking Modal -->
        <div id="booking-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Book Escort</h3>
                    <button onclick="closeBookingModal()" class="text-gray-500 hover:text-gray-700">&times;</button>
                </div>
                <div id="booking-content">
                    <!-- Booking form content will be populated here -->
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="success-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6 text-center">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-xl font-semibold mb-2">Success!</h3>
                <p id="success-message" class="text-gray-600 dark:text-gray-400 mb-4"></p>
                <button onclick="closeSuccessModal()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Global state
        let currentUser = null;
        let availableEscorts = [];
        let availableJobs = [];
        let pendingBookingEscortId = null;
        let actionHistory = []; // Track actions for undo functionality
        let originalUserType = null; // Store original user type for role switching

        // Admin email for notifications
        const ADMIN_EMAIL = 'amy223372@gmail.com';

        // EmailJS Configuration - CONFIGURED FOR amy223372@gmail.com
        const EMAILJS_SERVICE_ID = 'service_bbrwuzd';
        const EMAILJS_TEMPLATE_ID = 'template_gdfo6ps';
        const EMAILJS_PUBLIC_KEY = 'IBX91Cbie1JlXAWjS';

        // Sample data
        const sampleEscorts = [
            {
                id: 1,
                name: "Mary Chen",
                rating: 4.9,
                experience: "experienced",
                languages: ["cantonese", "english"],
                hourlyRate: 80,
                availability: "Available",
                completedJobs: 156,
                volunteer: true,
                photo: "üë©‚Äç‚öïÔ∏è",
                specialty: "Elderly Care",
                district: "Central & Western"
            },
            {
                id: 2,
                name: "John Wong",
                rating: 4.7,
                experience: "professional",
                languages: ["cantonese", "mandarin"],
                hourlyRate: 120,
                availability: "Available",
                completedJobs: 203,
                volunteer: false,
                photo: "üë®‚Äç‚öïÔ∏è",
                specialty: "Registered Nurse",
                district: "Wan Chai"
            },
            {
                id: 3,
                name: "Lisa Zhang",
                rating: 4.8,
                experience: "some",
                languages: ["mandarin", "english"],
                hourlyRate: 60,
                availability: "Available",
                completedJobs: 89,
                volunteer: true,
                photo: "üë©",
                specialty: "Student Volunteer",
                district: "Sha Tin"
            },
            {
                id: 4,
                name: "David Lam",
                rating: 4.6,
                experience: "experienced",
                languages: ["cantonese", "english"],
                hourlyRate: 90,
                availability: "Busy until 3 PM",
                completedJobs: 134,
                volunteer: false,
                photo: "üë®",
                specialty: "Physiotherapy Assistant",
                district: "Kowloon City"
            },
            {
                id: 5,
                name: "Susan Ng",
                rating: 4.9,
                experience: "professional",
                languages: ["cantonese", "english", "mandarin"],
                hourlyRate: 150,
                availability: "Available",
                completedJobs: 287,
                volunteer: false,
                photo: "üë©‚Äç‚öïÔ∏è",
                specialty: "Former Hospital Staff",
                district: "Eastern"
            },
            {
                id: 6,
                name: "Amy Wu",
                rating: 4.5,
                experience: "some",
                languages: ["cantonese"],
                hourlyRate: 50,
                availability: "Available",
                completedJobs: 45,
                volunteer: true,
                photo: "üëß",
                specialty: "University Student",
                district: "Sham Shui Po"
            },
            {
                id: 7,
                name: "Robert Chan",
                rating: 4.8,
                experience: "experienced",
                languages: ["english", "cantonese"],
                hourlyRate: 100,
                availability: "Available",
                completedJobs: 178,
                volunteer: false,
                photo: "üë®‚Äçüíº",
                specialty: "Family Caregiver",
                district: "Tsuen Wan"
            },
            {
                id: 8,
                name: "Grace Liu",
                rating: 4.7,
                experience: "professional",
                languages: ["mandarin", "cantonese", "english"],
                hourlyRate: 110,
                availability: "Available weekends",
                completedJobs: 95,
                volunteer: true,
                photo: "üë©‚Äç‚öïÔ∏è",
                specialty: "Healthcare Professional",
                district: "Yuen Long"
            },
            {
                id: 9,
                name: "Kevin Yeung",
                rating: 4.4,
                experience: "some",
                languages: ["cantonese", "english"],
                hourlyRate: 65,
                availability: "Available",
                completedJobs: 67,
                volunteer: false,
                photo: "üë¶",
                specialty: "Part-time Helper",
                district: "Kwun Tong"
            },
            {
                id: 10,
                name: "Helen Ho",
                rating: 4.9,
                experience: "experienced",
                languages: ["cantonese"],
                hourlyRate: 75,
                availability: "Available",
                completedJobs: 201,
                volunteer: true,
                photo: "üëµ",
                specialty: "Retired Nurse",
                district: "Wong Tai Sin"
            },
            {
                id: 11,
                name: "Michael Tam",
                rating: 4.3,
                experience: "none",
                languages: ["cantonese", "mandarin"],
                hourlyRate: 40,
                availability: "Available",
                completedJobs: 12,
                volunteer: true,
                photo: "üë®‚Äçüéì",
                specialty: "New Volunteer",
                district: "North"
            },
            {
                id: 12,
                name: "Catherine Lee",
                rating: 4.8,
                experience: "experienced",
                languages: ["english", "cantonese"],
                hourlyRate: 95,
                availability: "Available mornings",
                completedJobs: 156,
                volunteer: false,
                photo: "üë©",
                specialty: "Housewife & Caregiver",
                district: "Islands"
            }
        ];

        const sampleJobs = [
            {
                id: 1,
                patient: "Mrs. Lam",
                type: "Hospital Visit",
                date: "Tomorrow",
                time: "10:00 AM",
                location: "Queen Mary Hospital",
                payment: "$80",
                urgent: false,
                volunteer: false
            },
            {
                id: 2,
                patient: "Mr. Ng",
                type: "Clinic Appointment",
                date: "Dec 28",
                time: "2:00 PM",
                location: "Central Clinic",
                payment: "Volunteer",
                urgent: false,
                volunteer: true
            },
            {
                id: 3,
                patient: "Mrs. Ho",
                type: "Emergency Visit",
                date: "Today",
                time: "ASAP",
                location: "Prince of Wales Hospital",
                payment: "$150",
                urgent: true,
                volunteer: false
            }
        ];

        // Initialize
        function init() {
            showPage('landing-page');
            availableEscorts = [...sampleEscorts];
            availableJobs = [...sampleJobs];

            // Add event listeners for user type selection
            document.querySelectorAll('input[name="userType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    toggleUserFields(this.value);
                });
            });
        }

        // Navigation functions
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('#main-content > div').forEach(page => {
                page.classList.add('hidden');
            });

            // Show selected page
            document.getElementById(pageId).classList.remove('hidden');
        }

        function showRegister(userType = '') {
            showPage('auth-page');
            document.getElementById('auth-title').textContent = 'Join CareConnect';
            document.getElementById('auth-subtitle').textContent = 'Create your account to get started';
            document.getElementById('user-type-selection').style.display = 'block';

            if (userType) {
                document.querySelector(`input[name="userType"][value="${userType}"]`).checked = true;
                toggleUserFields(userType);
            }
        }

        function showLogin() {
            showPage('login-page');
        }

        function toggleUserFields(userType) {
            document.getElementById('patient-fields').classList.add('hidden');
            document.getElementById('escort-fields').classList.add('hidden');

            if (userType === 'patient') {
                document.getElementById('patient-fields').classList.remove('hidden');
            } else if (userType === 'escort') {
                document.getElementById('escort-fields').classList.remove('hidden');
            }
        }

        // Authentication functions
        function handleAuth(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const userData = Object.fromEntries(formData.entries());

            // Simulate account creation
            currentUser = {
                ...userData,
                id: Date.now(),
                joinDate: new Date().toISOString().split('T')[0]
            };

            // Store original user type
            originalUserType = currentUser.userType;

            // Track this action for undo
            addToHistory('registration', {
                action: 'User registered',
                user: {...currentUser}
            });

            // Send registration email notification
            sendEmailNotification('registration', currentUser);

            updateAuthUI();
            showDashboard();
            showSuccessMessage(`Welcome to CareConnect, ${userData.firstName}! Your account has been created successfully. Confirmation sent to ${ADMIN_EMAIL}`);
        }

        function handleLogin(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const email = formData.get('email');

            // Simulate login (in real app, this would validate credentials)
            currentUser = {
                email: email,
                firstName: email.includes('patient') ? 'Patient' : 'Escort',
                userType: email.includes('patient') ? 'patient' : 'escort',
                id: Date.now()
            };

            // Send login email notification
            sendEmailNotification('login', {
                email: email,
                timestamp: new Date().toISOString(),
                userType: currentUser.userType
            });

            updateAuthUI();
            showDashboard();
            showSuccessMessage(`Welcome back, ${currentUser.firstName}! Login notification sent to ${ADMIN_EMAIL}`);
        }

        function logout() {
            currentUser = null;
            updateAuthUI();
            showPage('landing-page');
        }

        function updateAuthUI() {
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const userGreeting = document.getElementById('user-greeting');
            const roleSwitchBtn = document.getElementById('role-switch-btn');
            const undoBtn = document.getElementById('undo-btn');

            if (currentUser) {
                loginBtn.classList.add('hidden');
                registerBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                userGreeting.classList.remove('hidden');
                roleSwitchBtn.classList.remove('hidden');

                const roleEmoji = currentUser.userType === 'patient' ? 'üë§' : 'ü§ù';
                const roleName = currentUser.userType === 'patient' ? 'Patient' : 'Escort';
                userGreeting.textContent = `${roleEmoji} Hello, ${currentUser.firstName} (${roleName})`;

                // Update role switch button text
                const switchToRole = currentUser.userType === 'patient' ? 'Escort' : 'Patient';
                roleSwitchBtn.innerHTML = `üîÑ Switch to ${switchToRole}`;

                // Show/hide undo button based on action history
                if (actionHistory.length > 0) {
                    undoBtn.classList.remove('hidden');
                    undoBtn.textContent = `‚Ü∂ Undo (${actionHistory.length})`;
                } else {
                    undoBtn.classList.add('hidden');
                }
            } else {
                loginBtn.classList.remove('hidden');
                registerBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                userGreeting.classList.add('hidden');
                roleSwitchBtn.classList.add('hidden');
                undoBtn.classList.add('hidden');
            }
        }

        function showDashboard() {
            showPage('dashboard');

            if (currentUser?.userType === 'patient') {
                document.getElementById('patient-dashboard').classList.remove('hidden');
                document.getElementById('escort-dashboard').classList.add('hidden');
            } else {
                document.getElementById('escort-dashboard').classList.remove('hidden');
                document.getElementById('patient-dashboard').classList.add('hidden');
                loadAvailableJobs();
            }
        }

        // Search and booking functions
        function searchEscorts() {
            const resultsDiv = document.getElementById('search-results');
            const escortsList = document.getElementById('escorts-list');

            resultsDiv.classList.remove('hidden');
            escortsList.innerHTML = '';

            availableEscorts.forEach(escort => {
                const escortCard = createEscortCard(escort);
                escortsList.appendChild(escortCard);
            });
        }

        function createEscortCard(escort) {
            const card = document.createElement('div');
            card.className = 'border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';

            // Create availability status styling
            const getAvailabilityClass = (availability) => {
                if (availability === "Available") return "bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";
                if (availability.includes("Busy") || availability.includes("until")) return "bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200";
                if (availability.includes("weekends") || availability.includes("mornings")) return "bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200";
                return "bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";
            };

            card.innerHTML = `
                <div class="flex items-start justify-between">
                    <div class="flex items-start space-x-4 flex-1">
                        <div class="text-3xl">${escort.photo}</div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <h4 class="font-semibold">${escort.name}</h4>
                                <span class="inline-block px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full">
                                    ${escort.specialty}
                                </span>
                            </div>
                            <p class="text-sm text-gray-500 mb-1">${escort.experience} ‚Ä¢ ${escort.completedJobs} jobs completed</p>
                            <p class="text-sm text-gray-500 mb-1">üìç ${escort.district} ‚Ä¢ Languages: ${escort.languages.join(', ')}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <span class="text-yellow-500">‚òÖ</span>
                                    <span class="text-sm ml-1">${escort.rating}</span>
                                    <span class="text-sm text-gray-500 ml-3">
                                        ${escort.volunteer ? 'ü§ù Free/Volunteer + ' : ''}üí∞ $${escort.hourlyRate}/hour
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-right ml-4">
                        <span class="inline-block px-2 py-1 text-xs ${getAvailabilityClass(escort.availability)} rounded-full mb-3 whitespace-nowrap">
                            ${escort.availability}
                        </span>
                        <button onclick="bookEscort(${escort.id})" class="block w-full bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors whitespace-nowrap">
                            Book Now
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        function bookEscort(escortId) {
            const escort = availableEscorts.find(e => e.id === escortId);
            if (!escort) return;

            const modal = document.getElementById('booking-modal');
            const content = document.getElementById('booking-content');

            content.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center space-x-3 p-3 border border-gray-200 dark:border-gray-600 rounded-lg">
                        <span class="text-2xl">${escort.photo}</span>
                        <div>
                            <h4 class="font-semibold">${escort.name}</h4>
                            <p class="text-sm text-gray-500">‚òÖ ${escort.rating} ‚Ä¢ ${escort.completedJobs} jobs</p>
                        </div>
                    </div>

                    <form onsubmit="confirmBooking(event, ${escortId})">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Date</label>
                                <input type="date" name="date" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Time</label>
                                <select name="time" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                    <option value="">Select time</option>
                                    <option value="9:00">9:00 AM</option>
                                    <option value="10:00">10:00 AM</option>
                                    <option value="11:00">11:00 AM</option>
                                    <option value="14:00">2:00 PM</option>
                                    <option value="15:00">3:00 PM</option>
                                    <option value="16:00">4:00 PM</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Hospital/Clinic</label>
                                <input type="text" name="location" required placeholder="e.g., Queen Mary Hospital" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Service Type</label>
                                <select name="serviceType" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                    <option value="">Select service</option>
                                    ${escort.volunteer ? '<option value="volunteer">Free (Volunteer)</option>' : ''}
                                    <option value="paid">Paid Service ($${escort.hourlyRate}/hour)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Additional Notes</label>
                                <textarea name="notes" rows="3" placeholder="Any special requirements or medical information the escort should know" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"></textarea>
                            </div>

                            <div class="flex space-x-3">
                                <button type="button" onclick="closeBookingModal()" class="flex-1 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                    Cancel
                                </button>
                                <button type="submit" class="flex-1 bg-primary text-white py-2 rounded-lg hover:bg-purple-600 transition-colors">
                                    Confirm Booking
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            `;

            modal.classList.remove('hidden');
        }

        function confirmBooking(event, escortId) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const bookingData = Object.fromEntries(formData.entries());
            const escort = availableEscorts.find(e => e.id === escortId);

            const fullBookingData = {
                patient: currentUser,
                escort: escort,
                bookingDetails: bookingData,
                timestamp: new Date().toISOString()
            };

            // Track this action for undo
            addToHistory('booking', {
                action: 'Booked escort',
                escortId: escortId,
                escortName: escort.name,
                bookingData: {...bookingData}
            });

            // Send booking email notification
            sendEmailNotification('booking', fullBookingData);

            closeBookingModal();
            showSuccessMessage(`Booking confirmed with ${escort.name}! Confirmation sent to ${ADMIN_EMAIL} and you'll receive an email shortly.`);
            updateAuthUI(); // Update undo button
        }

        function closeBookingModal() {
            document.getElementById('booking-modal').classList.add('hidden');
        }

        // Escort dashboard functions
        function loadAvailableJobs() {
            const jobsList = document.getElementById('available-jobs');
            jobsList.innerHTML = '';

            availableJobs.forEach(job => {
                const jobCard = createJobCard(job);
                jobsList.appendChild(jobCard);
            });
        }

        function createJobCard(job) {
            const card = document.createElement('div');
            card.className = `border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${job.urgent ? 'border-red-300 bg-red-50 dark:bg-red-900/20' : ''}`;

            card.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2 mb-2">
                            <h4 class="font-semibold">${job.patient} - ${job.type}</h4>
                            ${job.urgent ? '<span class="px-2 py-1 text-xs bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 rounded-full">Urgent</span>' : ''}
                            ${job.volunteer ? '<span class="px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full">Volunteer</span>' : ''}
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">üìÖ ${job.date} at ${job.time}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">üìç ${job.location}</p>
                        <p class="text-sm font-medium text-green-600 dark:text-green-400">üí∞ ${job.payment}</p>
                    </div>
                    <div class="text-right space-y-2">
                        <button onclick="acceptJob(${job.id})" class="block w-full bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                            Accept Job
                        </button>
                        <button class="block w-full text-primary border border-primary px-4 py-2 rounded-lg hover:bg-primary hover:text-white transition-colors text-sm">
                            View Details
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        function acceptJob(jobId) {
            const job = availableJobs.find(j => j.id === jobId);
            if (job) {
                // Track this action for undo
                addToHistory('job_acceptance', {
                    action: 'Accepted job',
                    job: {...job}
                });

                showSuccessMessage(`Job accepted! You'll be helping ${job.patient} on ${job.date}. Check your schedule for details.`);
                availableJobs = availableJobs.filter(j => j.id !== jobId);
                loadAvailableJobs();
                updateAuthUI(); // Update undo button
            }
        }

        function loadMoreJobs() {
            // Simulate loading more jobs
            const newJobs = [
                {
                    id: Date.now(),
                    patient: "Mrs. Yeung",
                    type: "Physical Therapy",
                    date: "Dec 30",
                    time: "11:00 AM",
                    location: "Rehabilitation Center",
                    payment: "$90",
                    urgent: false,
                    volunteer: false
                }
            ];

            availableJobs.push(...newJobs);
            loadAvailableJobs();
        }

        // Emergency booking
        function showEmergencyBooking() {
            const modal = document.getElementById('booking-modal');
            const content = document.getElementById('booking-content');

            content.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                        <span class="text-2xl">üö®</span>
                        <h4 class="font-semibold text-red-700 dark:text-red-400">Emergency Booking</h4>
                        <p class="text-sm text-red-600 dark:text-red-300">For immediate assistance within 2 hours</p>
                    </div>

                    <form onsubmit="confirmEmergencyBooking(event)">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Current Location</label>
                                <input type="text" name="location" required placeholder="Your current address" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Destination</label>
                                <input type="text" name="destination" required placeholder="Hospital/Clinic name and address" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Urgency Level</label>
                                <select name="urgency" required class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                                    <option value="">Select urgency</option>
                                    <option value="immediate">Immediate (within 30 minutes)</option>
                                    <option value="urgent">Urgent (within 1 hour)</option>
                                    <option value="priority">Priority (within 2 hours)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Contact Number</label>
                                <input type="tel" name="phone" required placeholder="For immediate contact" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Emergency Details</label>
                                <textarea name="details" rows="3" required placeholder="Brief description of the medical emergency or urgent need" class="w-full text-base px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"></textarea>
                            </div>

                            <div class="flex space-x-3">
                                <button type="button" onclick="closeBookingModal()" class="flex-1 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                    Cancel
                                </button>
                                <button type="submit" class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors">
                                    Request Emergency Escort
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            `;

            modal.classList.remove('hidden');
        }

        function confirmEmergencyBooking(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const emergencyData = Object.fromEntries(formData.entries());

            // Track this action for undo
            addToHistory('emergency_booking', {
                action: 'Emergency booking requested',
                emergencyData: {...emergencyData}
            });

            // Send emergency email notification
            sendEmailNotification('emergency_booking', emergencyData);

            closeBookingModal();
            showSuccessMessage('Emergency request submitted! Notification sent to ' + ADMIN_EMAIL + '. A qualified escort will contact you within 15 minutes. Please keep your phone available.');
            updateAuthUI(); // Update undo button
        }

        // Success modal functions
        function showSuccessMessage(message) {
            document.getElementById('success-message').textContent = message;
            document.getElementById('success-modal').classList.remove('hidden');
        }

        function closeSuccessModal() {
            document.getElementById('success-modal').classList.add('hidden');
        }

        // Landing page escort display
        function displayLandingEscorts() {
            const escortsList = document.getElementById('landing-escorts-list');
            if (!escortsList) return;

            // Show first 6 escorts on landing page
            const displayEscorts = availableEscorts.slice(0, 6);
            escortsList.innerHTML = '';

            displayEscorts.forEach(escort => {
                const card = createLandingEscortCard(escort);
                escortsList.appendChild(card);
            });
        }

        function createLandingEscortCard(escort) {
            const card = document.createElement('div');
            card.className = 'card-hover bg-gray-50 dark:bg-gray-700 p-6 rounded-xl shadow-lg';

            const getAvailabilityClass = (availability) => {
                if (availability === "Available") return "bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";
                if (availability.includes("Busy") || availability.includes("until")) return "bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200";
                if (availability.includes("weekends") || availability.includes("mornings")) return "bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200";
                return "bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";
            };

            card.innerHTML = `
                <div class="text-center mb-4">
                    <div class="text-5xl mb-3">${escort.photo}</div>
                    <h3 class="text-lg font-semibold mb-1">${escort.name}</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">${escort.specialty}</p>
                    <span class="inline-block px-3 py-1 text-xs ${getAvailabilityClass(escort.availability)} rounded-full">
                        ${escort.availability}
                    </span>
                </div>

                <div class="space-y-2 mb-4 text-sm">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600 dark:text-gray-400">üìç District:</span>
                        <span class="font-medium">${escort.district}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600 dark:text-gray-400">‚≠ê Rating:</span>
                        <span class="font-medium text-yellow-500">${escort.rating} (${escort.completedJobs} jobs)</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600 dark:text-gray-400">üó£Ô∏è Languages:</span>
                        <span class="font-medium">${escort.languages.join(', ')}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600 dark:text-gray-400">üí∞ Rate:</span>
                        <span class="font-medium text-primary">$${escort.hourlyRate}/hr${escort.volunteer ? ' + Free' : ''}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600 dark:text-gray-400">üìä Experience:</span>
                        <span class="font-medium capitalize">${escort.experience}</span>
                    </div>
                </div>

                <button onclick="showRegisterToBook(${escort.id})" class="w-full bg-primary text-white py-2 rounded-lg hover:bg-purple-600 transition-colors">
                    Book ${escort.name}
                </button>
            `;

            return card;
        }

        function showRegisterToBook(escortId) {
            // Store the escort ID for after registration
            pendingBookingEscortId = escortId;
            showRegister('patient');
        }

        // Location tracking and messaging functions
        function toggleTracking() {
            const trackingDiv = document.getElementById('active-tracking');
            trackingDiv.classList.toggle('hidden');

            if (!trackingDiv.classList.contains('hidden')) {
                // Simulate real-time updates
                simulateLocationUpdates();
            }
        }

        function hideTracking() {
            document.getElementById('active-tracking').classList.add('hidden');
        }

        function simulateLocationUpdates() {
            // Simulate location updates every 5 seconds
            let distance = 2.3;
            let eta = 8;

            const updateInterval = setInterval(() => {
                if (document.getElementById('active-tracking').classList.contains('hidden')) {
                    clearInterval(updateInterval);
                    return;
                }

                distance = Math.max(0.1, distance - 0.3);
                eta = Math.max(1, eta - 1);

                document.getElementById('distance-info').textContent = `Approximately ${distance.toFixed(1)} km away`;
                document.getElementById('eta-time').textContent = `${eta} minutes`;

                if (eta <= 1) {
                    document.getElementById('escort-location').textContent = 'Escort Location: Arriving at your location';
                    clearInterval(updateInterval);
                }
            }, 5000);
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();

            if (!message) return;

            addMessageToChat(message, 'patient');
            input.value = '';

            // Simulate escort response after 2 seconds
            setTimeout(() => {
                const responses = [
                    'Understood, thank you!',
                    'I\'ll be there soon.',
                    'No problem, see you shortly.',
                    'Got it, I\'m on my way.'
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessageToChat(randomResponse, 'escort');
            }, 2000);
        }

        function sendQuickMessage(message) {
            addMessageToChat(message, 'patient');

            // Simulate escort acknowledgment
            setTimeout(() => {
                addMessageToChat('Acknowledged ‚úì', 'escort');
            }, 1500);
        }

        function addMessageToChat(message, sender) {
            const chatDiv = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

            if (sender === 'patient') {
                messageDiv.className = 'flex items-start space-x-2 justify-end';
                messageDiv.innerHTML = `
                    <div class="bg-primary text-white rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                        <p class="text-xs opacity-75 mt-1">${timeStr}</p>
                    </div>
                    <div class="text-xl">üë§</div>
                `;
            } else {
                messageDiv.className = 'flex items-start space-x-2';
                messageDiv.innerHTML = `
                    <div class="text-xl">üë©‚Äç‚öïÔ∏è</div>
                    <div class="bg-white dark:bg-gray-600 rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${timeStr}</p>
                    </div>
                `;
            }

            chatDiv.querySelector('.space-y-3').appendChild(messageDiv);
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }

        function callEscort() {
            showCustomModal('Call Escort', `
                <div class="text-center py-6">
                    <div class="text-6xl mb-4">üìû</div>
                    <h3 class="text-xl font-semibold mb-2">Calling Mary Chen...</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">+852 9123 4567</p>
                    <div class="space-y-3">
                        <button onclick="closeCustomModal()" class="w-full bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">
                            End Call
                        </button>
                        <button onclick="closeCustomModal()" class="w-full border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            `);
        }

        function showEmergencyOptions() {
            showCustomModal('Emergency Options', `
                <div class="py-4">
                    <div class="space-y-3">
                        <button onclick="callEmergency()" class="w-full bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors text-left flex items-center">
                            <span class="text-2xl mr-3">üö®</span>
                            <div>
                                <div class="font-semibold">Call 999 Emergency Services</div>
                                <div class="text-sm opacity-90">For immediate medical emergency</div>
                            </div>
                        </button>
                        <button onclick="notifyFamily()" class="w-full bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors text-left flex items-center">
                            <span class="text-2xl mr-3">üë®‚Äçüë©‚Äçüëß</span>
                            <div>
                                <div class="font-semibold">Alert Emergency Contact</div>
                                <div class="text-sm opacity-90">Notify your family member</div>
                            </div>
                        </button>
                        <button onclick="reportIssue()" class="w-full bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition-colors text-left flex items-center">
                            <span class="text-2xl mr-3">‚ö†Ô∏è</span>
                            <div>
                                <div class="font-semibold">Report Issue with Escort</div>
                                <div class="text-sm opacity-90">Contact CareConnect support</div>
                            </div>
                        </button>
                        <button onclick="closeCustomModal()" class="w-full border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            `);
        }

        function callEmergency() {
            closeCustomModal();
            showSuccessMessage('Calling 999 Emergency Services... Please stay on the line.');
        }

        function notifyFamily() {
            closeCustomModal();
            showSuccessMessage('Emergency contact has been notified via SMS and phone call.');
        }

        function reportIssue() {
            closeCustomModal();
            showSuccessMessage('Your report has been submitted. A CareConnect support representative will contact you within 2 minutes.');
        }

        // Custom modal for complex dialogs
        function showCustomModal(title, content) {
            const modal = document.createElement('div');
            modal.id = 'custom-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">${title}</h3>
                        <button onclick="closeCustomModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    <div>${content}</div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeCustomModal() {
            const modal = document.getElementById('custom-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Role Switching Function (Option 3)
        function switchRole() {
            if (!currentUser) return;

            const currentRole = currentUser.userType;
            const newRole = currentRole === 'patient' ? 'escort' : 'patient';

            // Track this action for undo
            addToHistory('role_switch', {
                action: 'Switched role',
                previousRole: currentRole,
                newRole: newRole
            });

            // Switch the role
            currentUser.userType = newRole;

            // Update UI
            updateAuthUI();
            showDashboard();

            const emoji = newRole === 'patient' ? 'üë§' : 'ü§ù';
            showSuccessMessage(`${emoji} Successfully switched to ${newRole.charAt(0).toUpperCase() + newRole.slice(1)} mode!`);
        }

        // Undo Last Action Function (Option 5)
        function undoLastAction() {
            if (actionHistory.length === 0) {
                showSuccessMessage('No actions to undo.');
                return;
            }

            const lastAction = actionHistory.pop();

            switch(lastAction.type) {
                case 'registration':
                    // Undo registration - log out
                    currentUser = null;
                    originalUserType = null;
                    showPage('landing-page');
                    showSuccessMessage('Registration undone. You have been logged out.');
                    break;

                case 'booking':
                    showSuccessMessage(`Booking with ${lastAction.data.escortName} has been cancelled.`);
                    break;

                case 'job_acceptance':
                    // Add job back to available jobs
                    availableJobs.unshift(lastAction.data.job);
                    loadAvailableJobs();
                    showSuccessMessage(`Job acceptance undone. Job returned to available list.`);
                    break;

                case 'emergency_booking':
                    showSuccessMessage('Emergency booking request has been cancelled.');
                    break;

                case 'role_switch':
                    // Switch back to previous role
                    currentUser.userType = lastAction.data.previousRole;
                    showDashboard();
                    showSuccessMessage(`Switched back to ${lastAction.data.previousRole} mode.`);
                    break;

                case 'message_sent':
                    showSuccessMessage('Last message removed from chat.');
                    break;

                default:
                    showSuccessMessage('Action undone successfully.');
            }

            updateAuthUI(); // Update the undo button counter
        }

        // Add action to history
        function addToHistory(type, data) {
            actionHistory.push({
                type: type,
                data: data,
                timestamp: new Date().toISOString()
            });

            // Limit history to last 10 actions
            if (actionHistory.length > 10) {
                actionHistory.shift();
            }
        }

        // Back to Home function - reverse navigation from login/register
        function backToHome() {
            showPage('landing-page');
            // Track this navigation in history
            addToHistory('navigation', {
                action: 'Returned to home page',
                from: 'auth'
            });
            updateAuthUI();
        }

        // Initialize EmailJS
        (function() {
            if (typeof emailjs !== 'undefined' && EMAILJS_PUBLIC_KEY !== 'YOUR_PUBLIC_KEY') {
                emailjs.init(EMAILJS_PUBLIC_KEY);
                console.log('‚úÖ EmailJS initialized');
            }
        })();

        // Email Notification System - REAL EMAIL VIA EMAILJS
        async function sendEmailNotification(type, data) {
            let subject = '';
            let body = '';
            const timestamp = new Date().toLocaleString();

            switch(type) {
                case 'registration':
                    subject = `üÜï New User Registration - ${data.userType.toUpperCase()}`;
                    body = `
=== NEW USER REGISTRATION ===
Time: ${timestamp}
User Type: ${data.userType}

PERSONAL INFORMATION:
- Name: ${data.firstName} ${data.lastName}
- Email: ${data.email}
- Phone: ${data.phone}
- District: ${data.district}

${data.userType === 'patient' ? `
PATIENT DETAILS:
- Age: ${data.age || 'Not provided'}
- Category: ${data.patientCategory || 'Not specified'}
- Expected Experience: ${data.expectedExperience || 'Any'}
- Emergency Contact: ${data.emergencyContact || 'Not provided'}
- Medical Conditions: ${data.medicalConditions || 'None specified'}
- Financial Assistance: ${data.needsFinancialAssistance ? 'Yes' : 'No'}
` : `
ESCORT DETAILS:
- Experience Level: ${data.experience || 'Not specified'}
- Emergency Contact: ${data.emergencyContact || 'Not provided'}
- Hourly Rate: $${data.hourlyRate || '0'}/hour
- Volunteer Work: ${data.volunteerWork ? 'Yes' : 'No'}
`}

User ID: ${data.id}
Join Date: ${data.joinDate}
=================================
                    `;
                    break;

                case 'login':
                    subject = `üîê User Login Notification`;
                    body = `
=== USER LOGIN ===
Time: ${timestamp}
Email: ${data.email}
User Type: ${data.userType}
=================
                    `;
                    break;

                case 'booking':
                    subject = `üìÖ New Booking Request`;
                    body = `
=== NEW BOOKING ===
Time: ${timestamp}

PATIENT INFORMATION:
- Name: ${data.patient.firstName} ${data.patient.lastName}
- Email: ${data.patient.email}
- Phone: ${data.patient.phone}
- District: ${data.patient.district}

ESCORT INFORMATION:
- Name: ${data.escort.name}
- Specialty: ${data.escort.specialty}
- Rating: ${data.escort.rating}‚≠ê
- District: ${data.escort.district}
- Rate: $${data.escort.hourlyRate}/hour

BOOKING DETAILS:
- Date: ${data.bookingDetails.date}
- Time: ${data.bookingDetails.time}
- Location: ${data.bookingDetails.location}
- Service Type: ${data.bookingDetails.serviceType}
- Notes: ${data.bookingDetails.notes || 'None'}

Booking ID: ${Date.now()}
===================
                    `;
                    break;

                case 'emergency_booking':
                    subject = `üö® EMERGENCY BOOKING REQUEST`;
                    body = `
=== EMERGENCY BOOKING ===
Time: ${timestamp}
PRIORITY: HIGH

PATIENT: ${currentUser.firstName} ${currentUser.lastName}
Email: ${currentUser.email}
Phone: ${currentUser.phone}

EMERGENCY DETAILS:
- Current Location: ${data.location}
- Destination: ${data.destination}
- Urgency: ${data.urgency}
- Contact: ${data.phone}
- Details: ${data.details}

‚ö†Ô∏è IMMEDIATE ACTION REQUIRED
========================
                    `;
                    break;
            }

            // Display the email content in console (for development)
            console.log(`
üìß EMAIL NOTIFICATION
To: ${ADMIN_EMAIL}
Subject: ${subject}
${body}
            `);

            // Check if EmailJS is configured
            if (typeof emailjs === 'undefined' || EMAILJS_SERVICE_ID === 'YOUR_SERVICE_ID') {
                console.warn('‚ö†Ô∏è EmailJS not configured. Showing simulation.');
                showEmailModal(subject, body, false);
                return;
            }

            // Send REAL email via EmailJS
            try {
                const templateParams = {
                    to_email: ADMIN_EMAIL,
                    subject: subject,
                    message: body,
                    from_name: data.firstName ? `${data.firstName} ${data.lastName}` : 'CareConnect System',
                    from_email: data.email || 'system@careconnect.hk',
                    notification_type: type,
                    timestamp: timestamp
                };

                const response = await emailjs.send(
                    EMAILJS_SERVICE_ID,
                    EMAILJS_TEMPLATE_ID,
                    templateParams
                );

                console.log('‚úÖ Email sent successfully via EmailJS!', response);
                showEmailModal(subject, body, true); // Show success
            } catch (error) {
                console.error('‚ùå Error sending email:', error);
                showEmailModal(subject, body, false); // Show with warning
            }
        }

        // Show Email Modal
        function showEmailModal(subject, body, success = true) {
            const modal = document.createElement('div');
            modal.id = 'email-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';

            const statusIcon = success ? '‚úÖ' : '‚ö†Ô∏è';
            const statusText = success
                ? `Real email sent successfully to ${ADMIN_EMAIL}!`
                : `Email simulation (Setup Formspree to send real emails to ${ADMIN_EMAIL})`;
            const statusColor = success ? 'text-green-600 dark:text-green-400' : 'text-orange-600 dark:text-orange-400';

            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full p-6 max-h-96 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">üìß Email Notification</h3>
                        <button onclick="closeEmailModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                        <p class="font-semibold mb-2">To: ${ADMIN_EMAIL}</p>
                        <p class="font-semibold mb-2">Subject: ${subject}</p>
                        <pre class="text-sm whitespace-pre-wrap font-mono mt-3 border-t border-gray-300 dark:border-gray-600 pt-3">${body}</pre>
                    </div>
                    <div class="mt-4 text-center">
                        <p class="text-sm ${statusColor} mb-3 font-medium">
                            ${statusIcon} ${statusText}
                        </p>
                        ${!success ? `
                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">
                            To enable real emails: Sign up at <a href="https://emailjs.com" target="_blank" class="text-primary underline">emailjs.com</a> and update EmailJS config in the code.
                        </p>
                        ` : ''}
                        <button onclick="closeEmailModal()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Auto-close after 10 seconds
            setTimeout(() => {
                closeEmailModal();
            }, 10000);
        }

        function closeEmailModal() {
            const modal = document.getElementById('email-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Allow Enter key to send message
        document.addEventListener('DOMContentLoaded', () => {
            const messageInput = document.getElementById('message-input');
            if (messageInput) {
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        });

        // Initialize the app
        init();
        displayLandingEscorts();
    </script>
</body>
</html>
